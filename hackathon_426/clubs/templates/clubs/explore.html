{% load static %}
<link rel="stylesheet" href="{% static 'clubs/explore.css' %}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

<!-- Navigation Bar -->
<ul class="nav-bar">
  <a href=""><img class="nav-bar-img" src="{% static 'clubs/images/logo.png' %}" alt="CAPY Technologies Logo"></a>
  <a class="logout" href="{% url 'logout' %}"><i class="fas fa-lock"></i>Logout</a>
</ul>

<section class="explore-container">
  <h2 class="explore-title">Explore Clubs</h2>

  {% for club in clubs %}
    <div class="club-card" data-club-id="{{ club.id }}" {% if not forloop.first %}style="display:none;"{% endif %}>
      {% if club.banner %}
        <img class="club-banner" src="{{ club.banner.url }}" alt="Banner">
      {% endif %}
      <div class="club-info">
        {% if club.logo %}
          <img class="club-logo" src="{{ club.logo.url }}" alt="Logo">
        {% endif %}
        <div class="club-text">
          <h3>{{ club.name }}</h3>
          <p><strong>Description:</strong> {{ club.description }}</p>
          <p><strong>Meeting Dates:</strong> {{ club.meeting_dates }}</p>
          <p><strong>Meeting Times:</strong> {{ club.meeting_times }}</p>
        </div>
      </div>
    </div>
  {% endfor %}

  <p class="swipe-tip">Use your arrow keys: ‚Üê to dislike, ‚Üí to like</p>

  <form method="post" action="{% url 'reset_swipes' %}" class="reset-form">
    {% csrf_token %}
    <button type="submit" class="reset-btn">Reset My Swipes</button>
  </form>
</section>
  
<script>
  const cards = document.querySelectorAll('.club-card');
  let current = 0;

  async function swipe(action) {
    const card = cards[current];
    const clubId = card.dataset.clubId;

    // Hide current card
    card.style.display = 'none';
    current++;

    // Show next card if it exists
    if (current < cards.length) {
      cards[current].style.display = 'block';
    } else {
      alert("üéâ You've reached the end!");
    }

    // Send swipe to backend without reload
    try {
      await fetch(`/clubs/swipe/${clubId}/${action}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
        },
      });
    } catch (err) {
      console.error("Swipe failed:", err);
    }
  }

  document.addEventListener('keydown', function(event) {
    if (event.key === "ArrowRight") {
      swipe('like');
    } else if (event.key === "ArrowLeft") {
      swipe('dislike');
    }
  });

  // CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
