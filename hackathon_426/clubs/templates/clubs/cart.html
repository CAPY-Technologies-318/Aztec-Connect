{% load static %}
<link rel="stylesheet" href="{% static 'clubs/cart.css' %}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
<h2 class="cart-title">My Gym Buddies</h2>

<!-- Navigation Bar -->
<ul class="nav-bar">
  <a href=""><img class="nav-bar-img" src="{% static 'clubs/images/logo.png' %}" alt="CAPY Technologies Logo"></a>
  <div class="nav-links">
    <a class="nav-link {% if request.resolver_match.url_name == 'clubs_home' %}active{% endif %}" 
       href="{% url 'clubs_home' %}">Home</a>
    <a class="nav-link {% if request.resolver_match.url_name == 'explore' %}active{% endif %}" 
       href="{% url 'explore' %}">Explore</a>
    <a class="nav-link {% if request.resolver_match.url_name == 'cart' %}active{% endif %}" 
       href="{% url 'cart' %}">Cart</a>
    <a class="nav-link {% if request.resolver_match.url_name == 'user_profile' %}active{% endif %}"
        href="{% url 'user_profile' %}">Profile</a>
    <a class="logout" href="{% url 'logout' %}">
        <i class="fas fa-lock"></i>Logout
    </a>
  </div>
</ul>

<!-- Liked Gym Buddies Container -->
<div class="cart-container" id="liked-buddies-container">
  <h3 class="section-title">üí™ Liked Gym Buddies</h3>
  <div class="buddy-grid" id="buddy-grid">
    <!-- Gym buddies will be added here dynamically -->
  </div>
</div>

<style>
.cart-title {
    text-align: center;
    color: white;
    margin: 20px 0;
    font-size: 2em;
}

.section-title {
    text-align: center;
    color: white;
    margin: 20px 0;
    font-size: 1.5em;
    padding: 10px;
}

.cart-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.buddy-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px 0;
}

.buddy-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.buddy-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.buddy-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 0 auto 15px;
    overflow: hidden;
    border: 4px solid #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.buddy-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.buddy-info {
    text-align: center;
}

.buddy-info h3 {
    margin: 10px 0;
    color: #333;
}

.buddy-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.action-btn {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s ease;
}

.message-btn {
    background-color: #4CAF50;
    color: white;
}

.message-btn:hover {
    background-color: #45a049;
}

.remove-btn {
    background-color: #f44336;
    color: white;
}

.remove-btn:hover {
    background-color: #da190b;
}

.empty-cart {
    text-align: center;
    color: white;
    font-style: italic;
    padding: 40px;
    font-size: 1.2em;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.new-buddy {
    animation: slideIn 0.5s ease-out;
}
</style>

<script>
// Function to create a buddy card
function createBuddyCard(buddyData) {
    return `
        <div class="buddy-card new-buddy" data-buddy-id="${buddyData.id}">
            <div class="buddy-avatar">
                <img src="${buddyData.avatar}" alt="Buddy Avatar">
            </div>
            <div class="buddy-info">
                <h3>${buddyData.name}</h3>
                <p><strong>Description:</strong> ${buddyData.description}</p>
                <p><strong>Email:</strong> ${buddyData.email}</p>
                <p><strong>Preferred Time:</strong> ${buddyData.preferredTime}</p>
                <div class="buddy-actions">
                    <button class="action-btn message-btn" onclick="messageBuddy('${buddyData.id}')">
                        Message üí¨
                    </button>
                    <button class="action-btn remove-btn" onclick="removeBuddy('${buddyData.id}')">
                        Remove ‚ùå
                    </button>
                </div>
            </div>
        </div>
    `;
}

// Function to load liked buddies from localStorage
function loadLikedBuddies() {
    const buddyGrid = document.getElementById('buddy-grid');
    const likedBuddies = JSON.parse(localStorage.getItem('likedBuddies') || '[]');
    
    if (likedBuddies.length === 0) {
        buddyGrid.innerHTML = '<p class="empty-cart">No gym buddies added yet. Start exploring!</p>';
        return;
    }
    
    buddyGrid.innerHTML = likedBuddies.map(buddy => createBuddyCard(buddy)).join('');
}

// Function to add a new buddy to the cart
function addBuddyToCart(buddyData) {
    const buddyGrid = document.getElementById('buddy-grid');
    const emptyMessage = buddyGrid.querySelector('.empty-cart');
    
    if (emptyMessage) {
        buddyGrid.innerHTML = '';
    }
    
    const buddyCard = document.createElement('div');
    buddyCard.innerHTML = createBuddyCard(buddyData);
    buddyGrid.insertBefore(buddyCard.firstChild, buddyGrid.firstChild);
    
    // Store in localStorage
    const likedBuddies = JSON.parse(localStorage.getItem('likedBuddies') || '[]');
    likedBuddies.unshift(buddyData);
    localStorage.setItem('likedBuddies', JSON.stringify(likedBuddies));
}

// Function to remove a buddy from the cart
function removeBuddy(buddyId) {
    const card = document.querySelector(`[data-buddy-id="${buddyId}"]`);
    if (!card) return;
    
    card.style.animation = 'slideOut 0.5s ease-out';
    setTimeout(() => {
        card.remove();
        
        // Update localStorage
        const likedBuddies = JSON.parse(localStorage.getItem('likedBuddies') || '[]');
        const updatedBuddies = likedBuddies.filter(buddy => buddy.id !== buddyId);
        localStorage.setItem('likedBuddies', JSON.stringify(updatedBuddies));
        
        // Show empty message if no buddies left
        const buddyGrid = document.getElementById('buddy-grid');
        if (buddyGrid.children.length === 0) {
            buddyGrid.innerHTML = '<p class="empty-cart">No gym buddies added yet. Start exploring!</p>';
        }
    }, 500);
}

// Function to handle messaging (placeholder)
function messageBuddy(buddyId) {
    alert('Messaging feature coming soon!');
}

// Load liked buddies when the page loads
document.addEventListener('DOMContentLoaded', loadLikedBuddies);
</script>
